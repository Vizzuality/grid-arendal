<% picture_url = case media.type
                   when MediaContent::TYPE_ALBUM
                     photo = media.photos.order("id ASC").first
                     photo ? photo.photo_sizes.where(label: PhotoSize::MEDIUM).first.try(:url) : nil
                   when MediaContent::TYPE_PHOTO, MediaContent::TYPE_GRAPHIC
                     media.photo_sizes.where(label: PhotoSize::MEDIUM).first.try(:url)
                   when MediaContent::TYPE_COLLECTION
                     photo = media.graphics.order("id ASC").first
                     photo ? photo.photo_sizes.where(label: PhotoSize::MEDIUM).first.try(:url) : nil
                   else
                     nil
                 end

  video_provider = nil
  video_id = nil
  if media.type == MediaContent::TYPE_VIDEO
    if media.external_url.include?(Video::PROVIDER_YOUTUBE)
      video_provider = Video::PROVIDER_YOUTUBE
      video_id = media.external_url.split('=').last
    elsif media.external_url.include?(Video::PROVIDER_VIMEO)
      video_provider = Video::PROVIDER_VIMEO
      video_id = media.external_url.split('/').last
    end
  end

  photos_count = media.type == MediaContent::TYPE_ALBUM ? media.photos.size : 0
  videos_count = 0
  graphics_count = media.type == MediaContent::TYPE_COLLECTION ? media.graphics.size : 0
  needSteps = (photos_count + videos_count + graphics_count) > 2
  meta = []
  if photos_count == 1
    meta.push("1 photo")
  elsif photos_count > 0
    meta.push("#{photos_count} photos")
  end
  if videos_count == 1
    meta.push("1 video")
  elsif videos_count > 0
    meta.push("#{videos_count} videos")
  end
%>
<div class="item js_slide slide">
  <%= link_to medium_path(media) do %>
    <article class="c-card <% if needSteps %>-card-steps<% end %>" data-card-type="media">
      <div class="card-pic" <% if media.type == MediaContent::TYPE_VIDEO %>data-video-id="<%= video_id %>" data-video-provider="<%= video_provider %>"<% else %>style="background-image: url('<%= picture_url %>')"<% end %>></div>
      <div class="card-description">
        <h3 class="text -title-card-small"><%= media.title %></h3>
        <p class="text -meta"><%= meta.join(" | ") %></p>
      </div>
    </article>
  <% end %>
</div>
